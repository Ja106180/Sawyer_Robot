<?xml version="1.0"?>
<launch>
  <!-- 人脸跟踪节点启动文件 -->
  
  <node name="face_follow_node" 
        pkg="vision_control" 
        type="face_follow.py" 
        output="screen">
    
    <!-- 摄像头参数 -->
    <param name="camera_id" value="0" />
    <param name="frame_width" value="640" />
    <param name="frame_height" value="480" />
    <param name="fps" value="30.0" />
    
    <!-- 控制频率：提高频率以降低延迟 -->
    <param name="control_rate" value="40.0" />
    
    <!-- 人脸检测参数 -->
    <param name="face_confidence_threshold" value="0.75" />
    <param name="min_face_area_ratio" value="0.01" />
    <param name="max_face_area_ratio" value="0.5" />
    
    <!-- 虚拟弹簧控制参数（PD控制器） -->
    <!-- 参照左右（J4）的参数，上下（J5）用类似的参数，根据工程经验微调 -->
    <param name="kp_x" value="0.035" />  <!-- 水平方向比例系数（rad/pixel），左右工作很好 -->
    <param name="kp_y" value="0.030" />  <!-- 垂直方向比例系数（rad/pixel），稍微降低减少轻微抖动 -->
    
    <!-- 微分系数：垂直方向稍增强阻尼，抑制轻微抖动 -->
    <param name="kd_x" value="0.0020" />  <!-- 水平方向微分系数（rad·s/pixel），左右工作很好 -->
    <param name="kd_y" value="0.0030" />  <!-- 垂直方向微分系数（rad·s/pixel），增强阻尼消除抖动 -->
    
    <!-- 死区阈值：垂直方向稍增大死区，减少中心附近的微调 -->
    <param name="deadzone_x" value="12.0" />   <!-- 水平死区（像素），左右工作很好 -->
    <param name="deadzone_y" value="18.0" />   <!-- 垂直死区（像素），增大以消除轻微抖动 -->
    
    <!-- 最大速度限制（rad/s），保持当前最高速度不变（速度感不变） -->
    <param name="max_velocity_x" value="1.5" />  <!-- 水平最大速度 -->
    <param name="max_velocity_y" value="1.3" />  <!-- 垂直最大速度 -->
    
    <!-- 平滑滤波参数：参照左右，垂直方向稍增强平滑以消除轻微抖动 -->
    <param name="filter_alpha" value="0.82" />          <!-- 关节位置滤波系数，和左右一致 -->
    <param name="error_filter_alpha_x" value="0.75" />  <!-- 水平方向误差滤波，左右工作很好 -->
    <param name="error_filter_alpha_y" value="0.85" />  <!-- 垂直方向误差滤波，增强平滑消除轻微抖动 -->
    
    <!-- 超时保护 -->
    <param name="face_lost_timeout" value="2.0" />  <!-- 超时时间（秒） -->
    
    <!-- 关节限位（弧度） -->
    <param name="j4_min" value="-2.0" />
    <param name="j4_max" value="2.0" />
    <param name="j5_min" value="-2.0" />
    <param name="j5_max" value="1.7" />
    
  </node>
  
</launch>

